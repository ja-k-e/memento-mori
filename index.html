<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memento Mori</title>
    <style>
      html,
      body {
        height: 100%;
      }

      body {
        background: black;
        box-sizing: border-box;
        margin: 0;
        padding: 0.5rem;
      }

      canvas {
        display: block;
        height: 100%;
        image-rendering: pixelated;
        margin: 0 auto;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <canvas></canvas>

    <script>
      const dateStart = new Date(1987, 0, 23);
      const dateStop = new Date(2087, 0, 23);
      const now = Date.now();

      const addDaysToDate = (date, days) => {
        date.setDate(date.getDate() + days);
        return date;
      };

      let dateCurrent = new Date(dateStart);
      let dateAnniversary = new Date(dateCurrent);
      dateAnniversary.setYear(dateCurrent.getFullYear() + 1);

      const canvas = document.querySelector("canvas");
      const context = canvas.getContext("2d");
      canvas.height = window.innerHeight;
      canvas.width = window.innerWidth;
      const landscape = canvas.height > canvas.width ? 0 : 1;
      const nodeHeight = canvas.height / (landscape ? 100 : 366);
      const nodeWidth = canvas.width / (landscape ? 366 : 100);
      const nodeOffset = Math.min(nodeHeight, nodeWidth) * 0.25;
      const nodeDrawHeight = nodeHeight - nodeOffset * 2;
      const nodeDrawWidth = nodeWidth - nodeOffset * 2;

      context.fillStyle = "black";
      context.fillRect(0, 0, canvas.width, canvas.height);

      let index = 0;
      let x = 0;
      let y = 0;
      let daysOld = 0;

      for (let i = 0; i < 20; i++) {
        step();
      }

      function step() {
        if (dateCurrent < dateStop) {
          requestAnimationFrame(step);
          index++;
          const past = dateCurrent < now;
          if (!daysOld && !past) {
            daysOld = index;
            console.log(`${daysOld} days old`);
            console.log(
              `${((daysOld / 36525) * 100).toFixed(2)}% 100-year life lived`
            );
          }
          context.fillStyle = past ? "white" : "#666";
          context.fillRect(
            x + nodeOffset,
            y + nodeOffset,
            nodeDrawWidth,
            nodeDrawHeight
          );
          if (landscape) {
            x += nodeWidth;
          } else {
            y += nodeHeight;
          }

          addDaysToDate(dateCurrent, 1);

          if (dateCurrent >= dateAnniversary) {
            if (landscape) {
              y += nodeHeight;
              x = 0;
            } else {
              x += nodeWidth;
              y = 0;
            }
            dateAnniversary.setYear(dateCurrent.getFullYear() + 1);
          }
        }
      }
    </script>
  </body>
</html>
